# ADR-001: Timer oparty o Date.now i odporność na throttling event loop

## Status
Accepted

## Context
FocusFlow wymaga stabilnego odliczania Pomodoro w warunkach typowych dla przeglądarki: przełączanie kart, throttling timerów i opóźnienia event loop. Rozwiązanie oparte wyłącznie na inkrementowaniu ticków `setInterval` powoduje dryf i niespójny UX.

## Decision
Silnik timera liczy czas pozostały na podstawie czasu referencyjnego (`Date.now()`) i różnic czasu:
- źródło prawdy: timestamp startu i suma pauz,
- `setInterval` służy tylko do okresowego odświeżania UI,
- przejścia stanów timera aktualizują metadane czasu (`startedAt`, `pausedAt`, `totalPausedMs`).

## Consequences

### Positive
- Odporność na opóźnienia event loop i throttling w tle.
- Spójne wyniki po powrocie do karty.
- Lepsza testowalność przez podawanie `now` do funkcji.

### Negative
- Większa złożoność niż naiwny licznik ticków.
- Konieczność precyzyjnego zarządzania stanami pauzy/wznowienia.

## Alternatives considered
1. Tick-based countdown (`remainingMs -= 1000` co interwał) - odrzucone z powodu dryfu.
2. Web Worker timer - odrzucone jako nadmiarowe dla prostego MVP i hostingu statycznego.

## Verification
- Testy jednostkowe `timer.js` z kontrolowanym `now`.
- Test manualny: przełączenie karty na >= 30s i weryfikacja zgodności czasu po powrocie.